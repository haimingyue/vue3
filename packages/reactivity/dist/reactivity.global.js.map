{
  "version": 3,
  "sources": ["../src/index.ts", "../src/effect.ts", "../../shared/src/index.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export { effect } from './effect'\nexport { reactive } from './reactive'\n", "// import {ReactiveEffect} from \"vue\";\n\nexport let activeEffect = undefined;\nclass ReactiveEffect {\n    // \u7236\u4EB2\u662F\u54EA\u4E2Aeffect\n    public parent = null;\n    public deps = [];\n    // \u5728\u5B9E\u4F8B\u4E0A\u65B0\u589Eactive\n    public active = true; // \u8FD9\u4E2Aeffect\u9ED8\u8BA4\u662F\u6FC0\u6D3B\u72B6\u6001\n    constructor(public fn) {\n        //\u52A0public, \u8868\u793A\u7528\u6237\u4F20\u9012\u7684\u53C2\u6570\u4E5F\u653E\u5230this\u4E0A\u9762\u3002this.fn\n    }\n    run () {\n        // run\u5C31\u662F\u521B\u5EFAeffect\n        if (!this.active) {\n            // \u8FD9\u91CC\u8868\u793A\u5982\u679C\u662F\u975E\u6FC0\u6D3B\u72B6\u6001\uFF0C\u5C31\u53EA\u6267\u884C\u51FD\u6570\uFF0C\u4E0D\u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\n            return this.fn();\n        }\n        // \u8FD9\u91CC\u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\uFF1A\u628Aeffect\u53D8\u6210\u4E00\u4E2A\u5168\u5C40\u53D8\u91CF\n        // \u53D6\u503C\u7684\u65F6\u5019\uFF0C\u628A\u5168\u5C40\u53D8\u91CF\u548C\u5C5E\u6027\u5173\u8054\u8D77\u6765\n        try {\n            this.parent = activeEffect;\n            activeEffect = this;\n            return this.fn(); // \u5F53\u7A0D\u540E\u53D6\u503C\u7684\u65F6\u5019\uFF0C\u5C31\u53EF\u4EE5\u83B7\u53D6\u5230activeEffect\n        } finally {\n            activeEffect = this.parent;\n        }\n    }\n}\n\nexport function effect (fn) {\n    // fn\u53EF\u4EE5\u6839\u636E\u72B6\u6001\u53D8\u5316\u91CD\u65B0\u6267\u884C\n    // effect\u53EF\u4EE5\u5D4C\u5957\u7740\u5199\n    const _effect = new ReactiveEffect(fn);\n    _effect.run(); // \u9ED8\u8BA4\u5148\u6267\u884C\u4E00\u6B21\n}\n\nconst targetMap = new WeakMap();\nexport function track (target, type, key) {\n    if (!activeEffect) return;\n    let depsMap = targetMap.get(target);\n    if (!depsMap) {\n        targetMap.set(target, (depsMap = new Map()))\n    }\n    let dep = depsMap.get('key');\n    if (!dep) {\n        depsMap.set(key, (dep = new Set()))\n    }\n    let shouldTrack = !dep.has(activeEffect)\n    if (shouldTrack) {\n         dep.add(activeEffect)\n        activeEffect.deps.push(dep);\n    }\n    // \u5BF9\u8C61\u7684\u67D0\u4E2A\u5C5E\u6027\u6709\u591A\u4E2Aeffect\n}\n\n\nexport function trigger (target, type, key, value, oldValue) {\n    const depsMap = targetMap.get(target);\n    if (!depsMap) return;\n\n    const effects = depsMap.get(key); // \u627E\u5230\u4E86\u5C5E\u6027\u5BF9\u5E94\u7684effect\n    effects && effects.forEach(e => {\n        if (e !== activeEffect) {\n            e.run();\n        }\n    })\n}\n", "export const isObject = (value) => { \n    return typeof value === 'object' && value !== null;\n}", "\nimport { track, trigger } from \"./effect\";\nexport const enum ReactiveFlags {\n    IS_REACTIVE = '__v_isReactive'\n}\nexport const mutableHandlers = {\n    get (target, key, receiver) {\n        console.log(target)\n        console.log(key)\n        if (key === ReactiveFlags.IS_REACTIVE) {\n            return true;\n        }\n        // target:\n        // key:\n        // receiver: \u5F53\u524D\u7684\u4EE3\u7406\u5BF9\u8C61\uFF0C\u4FDD\u8BC1this\u7684\u6307\u5411\n        // \u53BB\u4EE3\u7406\u5BF9\u8C61\u4E0A\u53D6\u503C\uFF0C\u8D70get\n        // return target[key];\n        // \u8FD9\u91CC\u53EF\u4EE5\u76D1\u63A7\u5230\u7528\u6237\u53D6\u503C\n        track(target, 'get', key);\n        return Reflect.get(target, key, receiver);\n    },\n    set (target, key, value, receiver) {\n        // \u53BB\u4EE3\u7406\u4E0A\u8BBE\u7F6E\u503C\uFF0C\u8D70set\n        // target[key] = value;\n        let oldVal = target[key]\n        // \u8FD9\u91CC\u53EF\u4EE5\u76D1\u63A7\u5230\u7528\u6237\u8BBE\u7F6E\u503C\n        let result = Reflect.set(target, key, value, receiver);\n        if (oldVal !== result) {\n             // \u4E0D\u4E00\u81F4\u9700\u8981\u66F4\u65B0\n            trigger(target, 'set', key, value, oldVal)\n        }\n        return true;\n    }\n}\n", "import { isObject } from '@vue/shared'\nimport {mutableHandlers, ReactiveFlags} from './baseHandler'\n// \u7B2C\u4E00\u6B65\uFF1A\u5C06\u6570\u636E\u8F6C\u6362\u6210\u54CD\u5E94\u5F0F\u6570\u636E\n// 3. \u505A\u7F13\u5B58\uFF0CWeakMap\u4E0D\u4F1A\u5BFC\u81F4\u5185\u5B58\u6CC4\u9732\nconst reactiveMap = new WeakMap()\n// \u7B2C\u4E00\u6B21\u666E\u901A\u5BF9\u8C61\u4EE3\u7406\uFF0C\u53EF\u4EE5\u540Cnew Proxy\u4EE3\u7406\n// \u4E0B\u4E00\u6B21\u4F20\u9012\u7684\u662FProxy\uFF0C\u770B\u4E00\u4E0B\u6709\u6CA1\u6709\u4EE3\u7406\u8FC7\uFF0C\u5982\u679C\u8BBF\u95EE\u8FD9\u4E2AProxy\uFF0C\u6709get\u65B9\u6CD5\u7684\u65F6\u5019\uFF0C\u8BF4\u660E\u5C31\u8BBF\u95EE\u8FC7\u4E86\n\n// reactive \u53EA\u80FD\u505A\u5BF9\u8C61\u7684\u4EE3\u7406\n// 1) \u540C\u4E00\u4E2A\u5BF9\u8C61\u591A\u6B21\u4EE3\u7406\uFF0C\u8FD4\u56DE\u540C\u4E00\u4E2A\u4EE3\u7406\n// 2) \u4EE3\u7406\u5BF9\u8C61\u88AB\u518D\u6B21\u4EE3\u7406\uFF0C\u53EF\u4EE5\u76F4\u63A5\u8FD4\u56DE\nexport function reactive (target) {\n    // 1. \u5148\u5224\u65AD\u4F20\u5165\u7684object\u662F\u4E0D\u662F\u5BF9\u8C61\n    if (!isObject(target)) return;\n    if (target[ReactiveFlags.IS_REACTIVE]) {\n        return target;\n    }\n    // 2. \u5E76\u6CA1\u6709\u91CD\u65B0\u5B9A\u4E49\u5C5E\u6027\uFF0C\u53EA\u662F\u4EE3\u7406\uFF0C\u5728\u53D6\u503C\u7684\u65F6\u5019\uFF0C\u8C03\u7528get\uFF0C\u5728\u8D4B\u503C\u7684\u65F6\u5019\uFF0C\u8C03\u7528set\n    let existingProxy = reactiveMap.get(target);\n    console.log('existingProxy', existingProxy)\n    if (existingProxy) {\n        console.log('\u6267\u884C')\n        return existingProxy;\n    }\n    const proxy = new Proxy(target, mutableHandlers)\n    reactiveMap.set(target, proxy);\n    return proxy;\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACEO,MAAI,eAAe;AAC1B,MAAM,iBAAN,MAAqB;AAAA,IAMjB,YAAmB,IAAI;AAAJ;AAJnB,WAAO,SAAS;AAChB,WAAO,OAAO,CAAC;AAEf,WAAO,SAAS;AAAA,IAGhB;AAAA,IACA,MAAO;AAEH,UAAI,CAAC,KAAK,QAAQ;AAEd,eAAO,KAAK,GAAG;AAAA,MACnB;AAGA,UAAI;AACA,aAAK,SAAS;AACd,uBAAe;AACf,eAAO,KAAK,GAAG;AAAA,MACnB,UAAE;AACE,uBAAe,KAAK;AAAA,MACxB;AAAA,IACJ;AAAA,EACJ;AAEO,kBAAiB,IAAI;AAGxB,UAAM,UAAU,IAAI,eAAe,EAAE;AACrC,YAAQ,IAAI;AAAA,EAChB;AAEA,MAAM,YAAY,oBAAI,QAAQ;AACvB,iBAAgB,QAAQ,MAAM,KAAK;AACtC,QAAI,CAAC;AAAc;AACnB,QAAI,UAAU,UAAU,IAAI,MAAM;AAClC,QAAI,CAAC,SAAS;AACV,gBAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,IAC/C;AACA,QAAI,MAAM,QAAQ,IAAI,KAAK;AAC3B,QAAI,CAAC,KAAK;AACN,cAAQ,IAAI,KAAM,MAAM,oBAAI,IAAI,CAAE;AAAA,IACtC;AACA,QAAI,cAAc,CAAC,IAAI,IAAI,YAAY;AACvC,QAAI,aAAa;AACZ,UAAI,IAAI,YAAY;AACrB,mBAAa,KAAK,KAAK,GAAG;AAAA,IAC9B;AAAA,EAEJ;AAGO,mBAAkB,QAAQ,MAAM,KAAK,OAAO,UAAU;AACzD,UAAM,UAAU,UAAU,IAAI,MAAM;AACpC,QAAI,CAAC;AAAS;AAEd,UAAM,UAAU,QAAQ,IAAI,GAAG;AAC/B,eAAW,QAAQ,QAAQ,OAAK;AAC5B,UAAI,MAAM,cAAc;AACpB,UAAE,IAAI;AAAA,MACV;AAAA,IACJ,CAAC;AAAA,EACL;;;ACnEO,MAAM,WAAW,CAAC,UAAU;AAC/B,WAAO,OAAO,UAAU,YAAY,UAAU;AAAA,EAClD;;;ACGO,MAAM,kBAAkB;AAAA,IAC3B,IAAK,QAAQ,KAAK,UAAU;AACxB,cAAQ,IAAI,MAAM;AAClB,cAAQ,IAAI,GAAG;AACf,UAAI,QAAQ,oCAA2B;AACnC,eAAO;AAAA,MACX;AAOA,YAAM,QAAQ,OAAO,GAAG;AACxB,aAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,IAC5C;AAAA,IACA,IAAK,QAAQ,KAAK,OAAO,UAAU;AAG/B,UAAI,SAAS,OAAO;AAEpB,UAAI,SAAS,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AACrD,UAAI,WAAW,QAAQ;AAEnB,gBAAQ,QAAQ,OAAO,KAAK,OAAO,MAAM;AAAA,MAC7C;AACA,aAAO;AAAA,IACX;AAAA,EACJ;;;AC7BA,MAAM,cAAc,oBAAI,QAAQ;AAOzB,oBAAmB,QAAQ;AAE9B,QAAI,CAAC,SAAS,MAAM;AAAG;AACvB,QAAI,OAAO,qCAA4B;AACnC,aAAO;AAAA,IACX;AAEA,QAAI,gBAAgB,YAAY,IAAI,MAAM;AAC1C,YAAQ,IAAI,iBAAiB,aAAa;AAC1C,QAAI,eAAe;AACf,cAAQ,IAAI,cAAI;AAChB,aAAO;AAAA,IACX;AACA,UAAM,QAAQ,IAAI,MAAM,QAAQ,eAAe;AAC/C,gBAAY,IAAI,QAAQ,KAAK;AAC7B,WAAO;AAAA,EACX;",
  "names": []
}
